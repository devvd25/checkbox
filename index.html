<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Qu·∫£n l√Ω User</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f5f5f5;
    }
    h1 {
      text-align: center;
    }
    #userInput {
      padding: 8px;
      width: 250px;
    }
    button {
      padding: 8px 12px;
      margin-left: 5px;
      cursor: pointer;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      background: #fff;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }
    th {
      background: #007bff;
      color: white;
    }
    .dashboard {
      margin-top: 20px;
      padding: 15px;
      background: #fff;
      border: 1px solid #ddd;
    }
    input[type="number"] {
      width: 70px;
      padding: 5px;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>Qu·∫£n l√Ω User</h1>
  <input type="text" id="userInput" placeholder="Nh·∫≠p t√™n user...">
  <button onclick="addUser()">Th√™m User</button>
  <button onclick="saveHistory()">L∆∞u l·ªãch s·ª≠ h√¥m nay</button>
  <button onclick="viewHistory()">Xem l·ªãch s·ª≠</button>

  <table id="userTable">
    <thead>
      <tr>
        <th>User</th>
        <th>Ho√†n th√†nh</th>
        <th>S·ªë l·∫ßn Comment</th>
        <th>H√†nh ƒë·ªông</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="dashboard">
    <h2>Dashboard</h2>
    <p id="totalComments">T·ªïng s·ªë comment: 0</p>
  </div>

  <script>
    let users = [];

    function updateDashboard() {
      let total = users.reduce((sum, u) => sum + (parseInt(u.comments) || 0), 0);
      document.getElementById("totalComments").innerText =
        "T·ªïng s·ªë comment: " + total;
      saveUsers();
    }

    function addUser() {
      let input = document.getElementById("userInput");
      let name = input.value.trim();
      if (name === "") return;
      let user = { name, completed: false, comments: 0 };
      users.push(user);
      input.value = "";
      renderTable();
      updateDashboard();
    }

    function toggleComplete(index) {
      users[index].completed = !users[index].completed;
      saveUsers();
    }

    function updateComment(index, value) {
      users[index].comments = parseInt(value) || 0;
      updateDashboard();
    }

    function deleteUser(index) {
      users.splice(index, 1);
      renderTable();
      updateDashboard();
    }

    function renderTable() {
      let tbody = document.querySelector("#userTable tbody");
      tbody.innerHTML = "";
      users.forEach((user, index) => {
        let row = `<tr>
          <td>${user.name}</td>
          <td><input type="checkbox" ${user.completed ? "checked" : ""} onclick="toggleComplete(${index})"></td>
          <td><input type="number" value="${user.comments}" min="0" onchange="updateComment(${index}, this.value)"></td>
          <td><button onclick="deleteUser(${index})">X√≥a</button></td>
        </tr>`;
        tbody.innerHTML += row;
      });
    }

    function saveUsers() {
      localStorage.setItem("users", JSON.stringify(users));
    }

    function loadUsers() {
      let data = localStorage.getItem("users");
      if (data) {
        users = JSON.parse(data);
        renderTable();
        updateDashboard();
      }
    }

    function saveHistory() {
      let today = new Date();
      let key = today.toLocaleDateString("vi-VN"); // dd/mm/yyyy
      let history = JSON.parse(localStorage.getItem("history") || "{}");
      let total = users.reduce((sum, u) => sum + (parseInt(u.comments) || 0), 0);
      history[key] = { users, totalComments: total };
      localStorage.setItem("history", JSON.stringify(history));
      alert("‚úÖ ƒê√£ l∆∞u l·ªãch s·ª≠ ng√†y " + key);
    }

    // ---- Gom theo tu·∫ßn ----
    function getWeekRange(date) {
      // L·∫•y ng√†y (clone tr√°nh l·ªói)
      let d = new Date(date);
      let day = d.getDay(); // 0=CN, 1=T2,...
      let diffToMonday = (day === 0 ? -6 : 1) - day; 
      let monday = new Date(d);
      monday.setDate(d.getDate() + diffToMonday);
      let sunday = new Date(monday);
      sunday.setDate(monday.getDate() + 6);
      return {
        key: monday.toISOString().slice(0,10), // kh√≥a tu·∫ßn
        text: monday.toLocaleDateString("vi-VN") + " - " + sunday.toLocaleDateString("vi-VN")
      };
    }

    function viewHistory() {
      let history = JSON.parse(localStorage.getItem("history") || "{}");
      if (Object.keys(history).length === 0) {
        alert("Ch∆∞a c√≥ l·ªãch s·ª≠.");
        return;
      }

      let weeklyData = {};

      for (let dateStr in history) {
        // dateStr = dd/mm/yyyy
        let parts = dateStr.split("/");
        let d = new Date(parts[2], parts[1]-1, parts[0]);
        let weekInfo = getWeekRange(d);
        if (!weeklyData[weekInfo.key]) {
          weeklyData[weekInfo.key] = { range: weekInfo.text, total: 0 };
        }
        weeklyData[weekInfo.key].total += history[dateStr].totalComments;
      }

      let msg = "üìÖ L·ªãch s·ª≠ theo tu·∫ßn:\n";
      for (let key in weeklyData) {
        msg += `Tu·∫ßn (${weeklyData[key].range}): T·ªïng comment = ${weeklyData[key].total}\n`;
      }
      alert(msg);
    }

    window.onload = loadUsers;
  </script>
</body>
</html>
