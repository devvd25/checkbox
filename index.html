<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Qu·∫£n l√Ω User</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f5f5f5;
    }
    h1 {
      text-align: center;
    }
    #userInput {
      padding: 8px;
      width: 250px;
    }
    button {
      padding: 8px 12px;
      margin-left: 5px;
      cursor: pointer;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      background: #fff;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }
    th {
      background: #007bff;
      color: white;
    }
    .dashboard {
      margin-top: 20px;
      padding: 15px;
      background: #fff;
      border: 1px solid #ddd;
    }
    input[type="number"] {
      width: 70px;
      padding: 5px;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>Qu·∫£n l√Ω User</h1>
  <input type="text" id="userInput" placeholder="Nh·∫≠p t√™n user...">
  <button onclick="addUser()">Th√™m User</button>
  <button onclick="saveHistory()">L∆∞u l·ªãch s·ª≠ h√¥m nay</button>
  <button onclick="viewHistory()">Xem l·ªãch s·ª≠</button>

  <table id="userTable">
    <thead>
      <tr>
        <th>User</th>
        <th>Ho√†n th√†nh</th>
        <th>S·ªë l·∫ßn Comment</th>
        <th>H√†nh ƒë·ªông</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="dashboard">
    <h2>Dashboard</h2>
    <p id="totalComments">T·ªïng s·ªë comment: 0</p>
  </div>

  <script>
    let users = [];

    // --- C·∫≠p nh·∫≠t dashboard ---
    function updateDashboard() {
      let total = users.reduce((sum, u) => sum + (parseInt(u.comments) || 0), 0);
      document.getElementById("totalComments").innerText =
        "T·ªïng s·ªë comment: " + total;
      saveUsers(); // L∆∞u l·∫°i m·ªói khi c√≥ thay ƒë·ªïi
    }

    // --- Th√™m user ---
    function addUser() {
      let input = document.getElementById("userInput");
      let name = input.value.trim();
      if (name === "") return;
      let user = { name, completed: false, comments: 0 };
      users.push(user);
      input.value = "";
      renderTable();
      updateDashboard();
    }

    // --- Toggle ho√†n th√†nh ---
    function toggleComplete(index) {
      users[index].completed = !users[index].completed;
      saveUsers();
    }

    // --- C·∫≠p nh·∫≠t comment ---
    function updateComment(index, value) {
      users[index].comments = parseInt(value) || 0;
      updateDashboard();
    }

    // --- X√≥a user ---
    function deleteUser(index) {
      users.splice(index, 1);
      renderTable();
      updateDashboard();
    }

    // --- Render b·∫£ng ---
    function renderTable() {
      let tbody = document.querySelector("#userTable tbody");
      tbody.innerHTML = "";
      users.forEach((user, index) => {
        let row = `<tr>
          <td>${user.name}</td>
          <td><input type="checkbox" ${user.completed ? "checked" : ""} onclick="toggleComplete(${index})"></td>
          <td><input type="number" value="${user.comments}" min="0" onchange="updateComment(${index}, this.value)"></td>
          <td><button onclick="deleteUser(${index})">X√≥a</button></td>
        </tr>`;
        tbody.innerHTML += row;
      });
    }

    // --- L∆∞u user v√†o localStorage ---
    function saveUsers() {
      localStorage.setItem("users", JSON.stringify(users));
    }

    // --- T·∫£i user t·ª´ localStorage ---
    function loadUsers() {
      let data = localStorage.getItem("users");
      if (data) {
        users = JSON.parse(data);
        renderTable();
        updateDashboard();
      }
    }

    // --- L∆∞u l·ªãch s·ª≠ theo ng√†y ---
    function saveHistory() {
      let today = new Date().toLocaleDateString("vi-VN");
      let history = JSON.parse(localStorage.getItem("history") || "{}");
      let total = users.reduce((sum, u) => sum + (parseInt(u.comments) || 0), 0);
      history[today] = { users, totalComments: total };
      localStorage.setItem("history", JSON.stringify(history));
      alert("‚úÖ ƒê√£ l∆∞u l·ªãch s·ª≠ ng√†y " + today);
    }

    // --- Xem l·ªãch s·ª≠ ---
    function viewHistory() {
      let history = JSON.parse(localStorage.getItem("history") || "{}");
      let msg = "üìú L·ªãch s·ª≠ c√¥ng vi·ªác:\n";
      for (let date in history) {
        msg += `üìÖ ${date} - T·ªïng comment: ${history[date].totalComments}\n`;
      }
      alert(msg);
    }

    // --- Khi t·∫£i trang th√¨ load user ---
    window.onload = loadUsers;
  </script>
</body>
</html>
